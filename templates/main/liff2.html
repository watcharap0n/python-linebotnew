{% extends "bootstrap/base.html" %}

{%- block metas %}
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
{%- endblock metas %}

{% block scripts %}
{{super()}}
<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
<script>

    $(window).on('load', function () {
        liff.init({liffId: "1655104822-k5dRGJez"}, () => {
            if (liff.isLoggedIn()) {
                runApp()
            } else {
                liff.login();
            }
        }, err => console.error(err.code, error.message));
        // liff.init(function (data) {
    });
</script>

<script src="https://static.line-scdn.net/liff/edge/versions/2.3.0/sdk.js"></script>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    function runApp() {
        $('#btn').on('click', function () {
            liff.getProfile().then(profile => {
                $.ajax({
                    type: 'POST',
                    url: '/letme',
                    data: {
                        'firstname': $('#first').val(),
                        'lastname': $('#last').val(),
                        'email': $('#email').val(),
                        'company': $('#compa').val(),
                        'tel': $('#tel').val(),
                        'product': $('#pro').val(),
                        'displayName': profile.displayName
                    },
                    success: function (res, status) {
                        liff.getProfile().then(function (profile) {
                            console.log("res eang: ", res)
                            console.log("status: ", status)
                            liff.sendMessages([
                                {
                                    type: 'text',
                                    text: 'คุณ : ' + profile.displayName + '\n\n' + $('#first').val() + '  ' + $('#last').val() + '\n' + $('#email').val() + '\n' + $('#compa').val() + '\n' + $('#tel').val() + '\n' + $('#pro').val()
                                }
                            ]).then(function () {
                                liff.closeWindow();
                            }).catch(function (error) {
                                window.alert('Error sending message: ' + error.message);
                            });
                        }).catch(function (error) {
                            window.alert("Error getting profile: " + error.message);
                        });
                    },
                    error: function (res) {
                        window.alert('Error saving image: ' + res.status);
                    }
                });
            });
        });
    }
</script>
{% endblock %}

{% block title %}From Input{% endblock %}

{% block content %}
<br>
<div class="container">
    <form method="POST">
        <div class="form-group">
            <label for="first">Firstname:</label>
            <input type="text" class="form-control" id="first" placeholder="Enter Firstname"
                   name="firstname" value="">
        </div>
        <div class="form-group">
            <label for="last">Lastname:</label>
            <input type="text" class="form-control" id="last" placeholder="Enter Lastname"
                   name="lastname" value="">
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="text" class="form-control" id="email" placeholder="Enter email"
                   name="email" value="">
        </div>
        <div class="form-group">
            <label for="compa">Company:</label>
            <input type="text" class="form-control" id="compa" placeholder="Enter Company"
                   name="company" value="">
        </div>
        <div class="form-group">
            <label for="tel">Tel:</label>
            <input type="tel" class="form-control" id="tel" placeholder="Enter Tel"
                   name="tel" value="">
        </div>
        <div class="form-group">
            <label for="pro">Product:</label>
            <input type="text" class="form-control" id="pro" placeholder="Enter Product"
                   name="pro" value="">
        </div>
        <button id="btn" type="button" class="btn btn-primary btn-block">Share</button>
    </form>
</div>
{% endblock %}
