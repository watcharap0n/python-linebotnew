{% extends "bootstrap/base.html" %}

{%- block metas %}
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
{%- endblock metas %}

{% block scripts %}
{{super()}}
<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
<script>

    $(window).on('load', function () {
        liff.init({liffId: "1655104822-k5dRGJez"}, () => {
            if (liff.isLoggedIn()) {
                runApp()
            } else {
                liff.login();
            }
        }, err => console.error(err.code, error.message));
        // liff.init(function (data) {
    });
</script>

<script src="https://static.line-scdn.net/liff/edge/versions/2.3.0/sdk.js"></script>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    function runApp() {
        $('#btn').on('click', function () {
            liff.getProfile().then(profile => {
                $.ajax({
                    type: 'POST',
                    url: '/letme',
                    data: {
                        'firstname': $('#first').val(),
                        'email': $('#email').val(),
                        'company': $('#compa').val(),
                        'tel': $('#tel').val(),
                        'product': $('#pro').val(),
                        'userId': profile.userId,
                        'token': liff.getDecodedIDToken().email,
                        'displayName': profile.displayName,
                        'picture': profile.pictureUrl
                    },
                    success: function (res, status) {
                        liff.getProfile().then(function (profile) {
                            console.log("res eang: ", res)
                            console.log("status: ", status)
                            liff.closeWindow();
                        })
                    },

                });
            });
        });
    }
</script>
{% endblock %}

{% block title %}From Input{% endblock %}

{% block content %}
<br>

<div class="container">
    <form method="POST">
        <div class="form-group">
            <label for="first">Name:</label>
            <input type="text" class="form-control" id="first" placeholder="Enter Firstname"
                   name="firstname" value="" required>
        </div>
        <div class="form-group">
            <label for="compa">Company:</label>
            <input type="text" class="form-control" id="compa" placeholder="Enter Company"
                   name="company" value="" required>
        </div>
          <div class="form-group">
            <label for="pro">Product:</label><br>
            <select name="product" id="pro">
                <option value="">Please, select</option>
                {% for p in lst %}
                {% for i in p.product %}
                <option value="{{i}}" {% if i == i %} selected {% endif %}>
                    {{i}}
                </option>
                {% endfor %}
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email" placeholder="Enter email"
                   name="email" value="" required>
        </div>
        <div class="form-group">
            <label for="tel">Tel:</label>
            <input type="tel" class="form-control" id="tel" placeholder="Enter Tel"
                   name="tel" value="" required>
        </div>
        <button id="btn" type="button" class="btn btn-primary btn-block">Submit</button>
    </form>
</div>
{% endblock %}

