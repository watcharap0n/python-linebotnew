{% extends "sbadmin/layout2.html" %}
{% block content %}


        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
        </nav>
        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <h1 class="h3 mb-2 text-gray-800">Charts</h1>
         
          <div class="row">
            <div class="col-xl-6 col-md-6 mb-4">
              <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">จำนวนผู้ใช้</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800 pp">18</div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-user fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-6 col-md-6 mb-4">
              <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">จำนวนข้อความ</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800 mm">18</div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-comments fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Content Row -->

          <div class="row">

            <div class="col-xl-12 col-lg-12">

              <!-- Area Chart -->
              <div class="card shadow mb-4">
                <div class="card-header py-3 ">
                  <div class="row">
                    <h6 class="m-0 font-weight-bold text-primary col-8">ข้อมูลการใช้งาน </h6>
                    <!-- <label for=""></label> -->
                    <select onchange="changedata(this)" class="form-control col-4 float-right cd" name="" id="">
                      <option value="1">mouth</option>
                      <option value="2">day</option>
                    </select>
                  </div>
                </div>
                <div class="card-body">
                  <div class="chart-area">
                    <canvas id="myAreaChart"></canvas>
                  </div>
                  <hr>
                  <!-- Styling for the area chart can be found in the <code>/js/demo/chart-area-demo.js</code> file. -->
                </div>
              </div>

            </div>

            <div class="col-xl-4 col-lg-5 d-none">
              <div class="card shadow mb-4">
                
                <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">intent</h6>
                </div>
                <div class="card-body">
                  <div class="chart-pie pt-4">
                    <canvas id="myPieChart"></canvas>
                  </div>
                  <hr>
                
                </div>
              </div>
            </div>
          </div>
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">ข้อมูลการตอบกลับ</h6>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                  <thead>
                    <tr>
                      <th>index</th>
                      <th>message</th>
                      <th>reply</th>
                      <th>user id token</th>
                    </tr>
                  </thead>
                  <tfoot>
                    <tr>
                      <th>index</th>
                      <th>message</th>
                      <th>reply</th>
                      <th>user id token</th>
                    </tr>
                  </tfoot>
                  <tbody>
                    <tr v-for="(item, index) in message" :key="index">
                      <td>[[index+1]]</td>
                      <td>[[item.message]]</td>
                      <td>[[item.reply]]</td>
                      <td>[[item.userid]]</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright &copy; Your Website 2020</span>
          </div>
        </div>
      </footer>
      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Logout Modal-->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" href="login.html">Logout</a>
        </div>
      </div>
  
  <!-- Bootstrap core JavaScript-->
<!--  <script src="vendor/jquery/jquery.min.js"></script>-->
<!--  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>-->

<!--  &lt;!&ndash; Core plugin JavaScript&ndash;&gt;-->
<!--  <script src="vendor/datatables/jquery.dataTables.min.js"></script>-->
<!--  <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>-->
<!--  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>-->

<!--  &lt;!&ndash; Custom scripts for all pages&ndash;&gt;-->
<!--  <script src="js/sb-admin-2.min.js"></script>-->

<!--  &lt;!&ndash; Page level plugins &ndash;&gt;-->
<!--  <script src="vendor/chart.js/Chart.min.js"></script>-->

<!--  &lt;!&ndash; Page level custom scripts &ndash;&gt;-->
<!--  <script src="js/demo/datatables-demo.js"></script>-->
<!--  <script src="js/demo/chart-area-demo.js"></script>-->
<!--  <script src="js/demo/chart-pie-demo.js"></script>-->
  <!-- <script src="js/demo/chart-bar-demo.js"></script> -->
<script src="{{ url_for('static', filename='/js/demo/chart-area-demo.js') }}"></script>
<script src="{{ url_for('static', filename='/js/demo/chart-bar-demo.js') }}"></script>
<script src="{{ url_for('static', filename='/js/demo/chart-pie-demo.js') }}"></script>
<script src="{{ url_for('static', filename='/js/demo/datatables-demo.js') }}"></script>

  <script>
  db=firebase.database()
    let data = db.ref('get_transaction')
    let intentData = db.ref('chatbot_transactions')
    let datalist = [];
    let toDay = new Date()
    let potyear = []
    let potday = []
    let labelDay = []
    let pp = []
    let dataArr = []

    function changedata(e) {
      if ($(e).val() == 1) {
        myLineChart.data.datasets[0].data = potyear;
        myLineChart.data.labels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
      } else {
        myLineChart.data.datasets[0].data = potday;
        myLineChart.data.labels = labelDay
      }
      myLineChart.update()
    }
    data = data.on("value", function (snp) {
      console.log(snp.val());
      datasnp = snp.val();
      dataArr = []
      potyear=[]
      potday=[]
      labelDay =[]
      for (const key in datasnp) {
        dataArr.push(datasnp[key])
        pp.push(datasnp[key].id)

      }
      console.log(pp);
      let ppp = new Set(pp)
      console.log(ppp.size);
      $('.pp').html(ppp.size)
      $('.mm').html(dataArr.length)
      // console.log(dataArr.length);
      // console.log(datasnp.length);
      // const filterToYear = dataArr.filter((dataArr) => {
      //   return dataArr.year == toDay.getFullYear()
      // })
      for (let i = 0; i <= 11; i++) {
        // const element = array[i];
        const filterTomouth1 = dataArr.filter((dataArr) => {
          return dataArr.year == toDay.getFullYear() && dataArr.month == i
        })
        potyear.push(filterTomouth1.length)
      }
      for (let i = 9; i >= 0; i--) {
        // const element = array[i];
        const filterTomouth1 = dataArr.filter((dataArr) => {
          // console.log( dataArr.month);
          // console.log(toDay.getMonth()+1);
          // console.log(dataArr.day);
          console.log( toDay.getDate()-i);
          return dataArr.year == toDay.getFullYear() &&
                  dataArr.month == toDay.getMonth() + 1
                  && dataArr.day == toDay.getDate() -i
        })
        labelDay.push(toDay.getFullYear() + "-" + (toDay.getMonth() + 1) + "-" + (toDay.getDate() -i))
        potday.push(filterTomouth1.length)
      }
      console.log(labelDay);
      if ($('.cd').val() == 1) {
        myLineChart.data.datasets[0].data = potyear;
        myLineChart.data.labels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
      } else {
        myLineChart.data.datasets[0].data = potday;
        myLineChart.data.labels = labelDay
      }

      myLineChart.update()
      // console.log(potyear);
      // console.log(potday);

      // console.log(db);
    })
    intentData = intentData.on('value', function (snp) {
      let dataArrtran = []
      let trandata = snp.val();
      for (const key in trandata) {
        dataArrtran.push(trandata[key])
        // pp.push(datasnp[key].id)

      }
      console.log(trandata);
      var app = new Vue({
        el: '#dataTable',
        data: {
          message: dataArrtran,

        },
        delimiters: ["[[", "]]"],
        mounted() {
          console.log("vue : " + this.message);
        },
        methods: {

        },
        created() {

        },


      })
    })
  </script>
{% endblock %}
